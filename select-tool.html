<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Zoom Region Selector</title>
    <style>
        body {
            background: #111;
            color: #eee;
            font-family: sans-serif;
            margin: 20px;
        }
        #container {
            position: relative;
            margin: 20px 0;
            display: inline-block;
        }
        #imagePreview {
            max-width: 100%;
            border: 1px solid #333;
            user-select: none;
            -webkit-user-drag: none;
        }
        #selection {
            position: absolute;
            border: 2px solid #00ff88;
            box-shadow: 0 0 6px #00ff88;
            background: rgba(0, 255, 136, 0.1);
            pointer-events: none;
        }
        #output {
            font-family: monospace;
            background: #222;
            padding: 10px;
            border-radius: 4px;
        }
        button {
            background: #333;
            color: #eee;
            border: 1px solid #666;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #444;
        }
    </style>
</head>
<body>
    <h1>Zoom Region Selector</h1>
    <input type="file" id="imageInput" accept="image/*">
    <div id="container">
        <img id="imagePreview" alt="Preview">
        <div id="selection"></div>
    </div>
    <div>
        <p>Image dimensions: <span id="dimensions">-</span></p>
        <p>Selected region:</p>
        <pre id="output">Click and drag on the image to select a region</pre>
        <button id="copyPixel">Copy Pixel Coordinates</button>
        <button id="copyRelative">Copy Relative Coordinates</button>
    </div>

    <script>
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const container = document.getElementById('container');
        const selection = document.getElementById('selection');
        const output = document.getElementById('output');
        const dimensions = document.getElementById('dimensions');
        
        let isDrawing = false;
        let startX, startY;
        
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    imagePreview.onload = () => {
                        dimensions.textContent = `${imagePreview.naturalWidth}x${imagePreview.naturalHeight}`;
                    };
                };
                reader.readAsDataURL(file);
            }
        });

        function clamp(value, min, max) {
            return Math.max(min, Math.min(max, value));
        }

        function handleSelection(e) {
            if (!isDrawing) return;
            
            e.preventDefault(); // Prevent any default dragging behavior
            
            const rect = container.getBoundingClientRect();
            const imgRect = imagePreview.getBoundingClientRect();
            
            // Get current mouse position relative to container
            let currentX = clamp(e.clientX - rect.left, 0, imgRect.width);
            let currentY = clamp(e.clientY - rect.top, 0, imgRect.height);
            
            // Calculate width and height
            let width = currentX - startX;
            let height = currentY - startY;
            
            // Ensure selection stays within image bounds
            if (startX + width < 0) width = -startX;
            if (startX + width > imgRect.width) width = imgRect.width - startX;
            if (startY + height < 0) height = -startY;
            if (startY + height > imgRect.height) height = imgRect.height - startY;
            
            // Update selection element
            selection.style.width = Math.abs(width) + 'px';
            selection.style.height = Math.abs(height) + 'px';
            selection.style.left = (width < 0 ? startX + width : startX) + 'px';
            selection.style.top = (height < 0 ? startY + height : startY) + 'px';
            
            updateOutput();
        }

        // Prevent image dragging
        imagePreview.addEventListener('dragstart', (e) => e.preventDefault());

        container.addEventListener('mousedown', (e) => {
            e.preventDefault();
            
            const rect = container.getBoundingClientRect();
            const imgRect = imagePreview.getBoundingClientRect();
            
            // Ensure starting point is within image bounds
            startX = clamp(e.clientX - rect.left, 0, imgRect.width);
            startY = clamp(e.clientY - rect.top, 0, imgRect.height);
            
            selection.style.left = startX + 'px';
            selection.style.top = startY + 'px';
            selection.style.width = '0';
            selection.style.height = '0';
            
            isDrawing = true;
        });

        container.addEventListener('mousemove', handleSelection);
        container.addEventListener('mouseup', (e) => {
            if (!isDrawing) return;
            handleSelection(e);
            isDrawing = false;
        });

        function updateOutput() {
            const scale = imagePreview.naturalWidth / imagePreview.offsetWidth;
            const rect = selection.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();
            
            const x = Math.round((rect.left - containerRect.left) * scale);
            const y = Math.round((rect.top - containerRect.top) * scale);
            const w = Math.max(Math.round(rect.width * scale), 1);  // Ensure minimum size of 1
            const h = Math.max(Math.round(rect.height * scale), 1); // Ensure minimum size of 1
            
            const relX = x / imagePreview.naturalWidth;
            const relY = y / imagePreview.naturalHeight;
            const relW = w / imagePreview.naturalWidth;
            const relH = h / imagePreview.naturalHeight;

            output.textContent = 
`// Pixel coordinates [x, y, width, height]:
nextPixelRect: [${Math.round(x)}, ${Math.round(y)}, ${Math.round(w)}, ${Math.round(h)}],

// Relative coordinates [x, y, width, height]:
nextRect: [${relX.toFixed(3)}, ${relY.toFixed(3)}, ${relW.toFixed(3)}, ${relH.toFixed(3)}],`;
        }

        document.getElementById('copyPixel').addEventListener('click', () => {
            const match = output.textContent.match(/nextPixelRect: (.*),/);
            if (match) {
                navigator.clipboard.writeText(match[1]);
                alert('Pixel coordinates copied to clipboard!');
            }
        });

        document.getElementById('copyRelative').addEventListener('click', () => {
            const match = output.textContent.match(/nextRect: (.*),/);
            if (match) {
                navigator.clipboard.writeText(match[1]);
                alert('Relative coordinates copied to clipboard!');
            }
        });
    </script>
</body>
</html>